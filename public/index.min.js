var chach="",cursor=null,tele=!1,socket=io("",{transports:["websocket"]});socket.on("welcome",function(e){socket.emit("require",{uuid:document.cookie,ask:!1})}),socket.on("data",function(e){document.cookie=e.uuid,strarr=e.strarr,$("#qrcode").empty(),$("#qrcode").qrcode({text:getURLStr(e.uuid),width:128,height:128})}),socket.on("clipboard",function(e){tele=!0,cursor="cursor"in e?e.cursor:null,setText(e.str)}),socket.on("ask",function(e){shareText(getText())}),$(window).focus(function(){$("#cover").hide()}),$(window).blur(function(){$("#cover").show()}),$("#cover").hide(),$("#qrcode").click(function(){var e=getURLStr(document.cookie);setText(e),shareText(e)});var editor=CodeMirror.fromTextArea(document.getElementById("area"),{lineNumbers:!0,autofocus:!0});function writeToClipOrChach(t){chach="","clipboard"in navigator?navigator.clipboard.writeText(t).catch(function(e){chach=t}):chach=t}function shareText(e){socket.emit("clipboard",{uuid:document.cookie,str:e,src:"web",cursor:editor.getCursor()})}function setText(e){editor.setValue(e),editor.setCursor(editor.lineCount(),0)}function getText(){return editor.getValue()}function getURLStr(e){return window.location.href.split("?")[0]+"?id="+e}editor.setSize("100%","100%"),editor.on("change",function(){writeToClipOrChach(getText()),tele?(null!=cursor&&editor.setCursor(cursor),tele=!1):(shareText(getText()),cursor=null)}),editor.on("focus",function(){null!=cursor&&(editor.setCursor(cursor),cursor=null),"clipboard"in navigator&&navigator.clipboard.readText().then(function(e){e!=getText()?(setText(e),shareText(e)):""!=chach&&(chach!=getText()?(setText(chach),shareText(chach)):writeToClipOrChach(chach))}).catch(function(e){writeToClipOrChach(chach)})}),editor.on("blur",function(){cursor=null,editor.focus()});