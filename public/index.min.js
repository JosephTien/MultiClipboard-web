var chach="",cursor=null,tele=!1,socket=io("",{transports:["websocket"]});socket.on("welcome",function(t){var e=getUUID();"clipboard"in navigator?socket.emit("require",{uuid:e,ask:!1}):socket.emit("require",{uuid:e,ask:!0})}),socket.on("data",function(t){setUUID(t.uuid),strarr=t.strarr,$("#qrcode").empty(),$("#qrcode").qrcode({text:getURLStr(t.uuid),width:128,height:128})}),socket.on("clipboard",function(t){tele=!0,cursor="cursor"in t?t.cursor:null,setText(t.str)}),socket.on("ask",function(t){shareText(getText())}),$(window).focus(function(){$("#cover").hide()}),$(window).blur(function(){$("#cover").show()}),$("#cover").hide(),$("#qrcode").click(function(){var t=getURLStr(getUUID());setText(t),shareText(t)});var editor=CodeMirror.fromTextArea(document.getElementById("area"),{lineNumbers:!0,autofocus:!0});function getUUID(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var r=t[e].split("=");if("id"===r[0].trim())return r.length<2?"":r[1].trim()}return""}function setUUID(t){document.cookie="id="+t}function writeToClipOrChach(e){chach="","clipboard"in navigator?navigator.clipboard.writeText(e).catch(function(t){chach=e}):chach=e}function shareText(t){socket.emit("clipboard",{uuid:getUUID(),str:t,src:"web",cursor:editor.getCursor()})}function setText(t){editor.setValue(t),editor.setCursor(editor.lineCount(),0)}function getText(){return editor.getValue()}function getURLStr(t){return window.location.href.split("?")[0]+"?id="+t}editor.setSize("100%","100%"),editor.on("change",function(){writeToClipOrChach(getText()),tele?(null!=cursor&&editor.setCursor(cursor),tele=!1):(shareText(getText()),cursor=null)}),editor.on("focus",function(){null!=cursor&&(editor.setCursor(cursor),cursor=null),"clipboard"in navigator&&navigator.clipboard.readText().then(function(t){t!=getText()?(setText(t),shareText(t)):""!=chach&&(chach!=getText()?(setText(chach),shareText(chach)):writeToClipOrChach(chach))}).catch(function(t){writeToClipOrChach(chach)})}),editor.on("blur",function(){cursor=null,editor.focus()});